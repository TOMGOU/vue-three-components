{"version":3,"file":"Signal.stories-d866dd7e.js","sources":["../../packages/Signal/texture/signal.png","../../packages/Signal/index.ts","../../src/stories/components/signal/index.vue"],"sourcesContent":["export default \"__VITE_ASSET__5d59839b__\"","import * as THREE from 'three'\nimport imgSrc from './texture/signal.png'\n\nconst createSignalMesh = (size: number = 1, color: string = '#ffff00') => {\n  const texLoad = new THREE.TextureLoader();\n  const geometry = new THREE.PlaneGeometry(size, 0.6 * size);\n  geometry.translate(-size / 2, 0, 0);\n  geometry.rotateZ(Math.PI / 2);\n  const material = new THREE.MeshLambertMaterial({\n    // map: texLoad.load('/texture/signal.png'),\n    map: texLoad.load(imgSrc),\n    color: new THREE.Color(color), //设置颜色\n    transparent: true, //允许透明计算\n    side: THREE.DoubleSide,\n    emissive: new THREE.Color(color),\n  });\n  \n  const plane = new THREE.Mesh(geometry, material);\n  plane.rotateX(-Math.PI / 3)\n\n  // 波动动画\n  const S= 1000;//波动范围倍数设置\n  let _s = 1;\n  function animation() {\n    _s += 20;\n    plane.scale.set(_s, _s,  _s);\n    if (_s <= S*0.2) {\n        material.opacity = (_s - 1) /(S*0.2-1);//保证透明度在0~1之间变化\n    } else if (_s > S*0.2 && _s <= S) {\n        material.opacity = 1 - (_s - S*0.2) /(S - S*0.2);//保证透明度在0~1之间变化\n    } else {\n        _s = 1.0;\n    }\n    requestAnimationFrame(animation);\n  }\n  animation();\n  \n  return plane;\n}\n\nexport { createSignalMesh }\n","<template>\n  <div id=\"Signal\"></div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted, onBeforeUpdate, watch, onBeforeMount } from 'vue';\nimport * as THREE from 'three'\nimport {\n  scene,\n  renderer,\n  camera,\n  ambientLight,\n  hemisphereLight,\n  dirLight,\n  dirLight1,\n  dirLight2,\n  spotLight\n} from '../basic/three'\n// import { controls } from '../basic/controls'\nimport { createSignalMesh } from '../../../../packages/index'\n\nconst props = defineProps({\n  size: {\n    type: Number,\n    default: 20,\n    required: false\n  },\n  color: {\n    type: String,\n    default: '#22ffcc',\n    required: false\n  }\n})\n\nlet timer: any = null\n\nonBeforeMount(() => {\n  if (timer) cancelAnimationFrame(timer)\n  scene.remove.apply(scene, scene.children)\n})\n\nonMounted(() => {\n  // 添加光源\n  scene.add(ambientLight)\n  scene.add(hemisphereLight)\n  scene.add(dirLight)\n  scene.add(dirLight1)\n  scene.add(dirLight2)\n  scene.add(spotLight)\n\n  // 重置相机缩放比例\n  camera.zoom = 1;\n\n  // 添加棱锥网格\n  const SignalMesh = createSignalMesh(props.size, props.color)\n  SignalMesh.position.z = 0\n  SignalMesh.position.y = 300\n  // SignalMesh.rotateX(-Math.PI / 4)\n  scene.add( SignalMesh );\n\n  // const axesHelper = new THREE.AxesHelper(5000);\n  // scene.add(axesHelper);\n\n  const SignalElement = document.getElementById('Signal')\n  if (SignalElement) SignalElement.appendChild(renderer.domElement)\n  const render = () => {\n    renderer.render(scene, camera)\n    camera.updateProjectionMatrix()\n    // controls.update()\n    timer = requestAnimationFrame(render)\n  }\n\n  render()\n})\n\nonBeforeUpdate(() => {\n  console.log('onBeforeUpdate')\n  renderer.clear()\n  scene.remove.apply(scene, scene.children)\n  scene.remove.apply(scene, scene.children)\n  renderer.forceContextLoss()\n  cancelAnimationFrame(timer)\n  const gl = renderer.domElement.getContext('webgl')\n  gl && gl.getExtension('WEBGL_lose_context')?.loseContext()\n})\n</script>"],"names":["imgSrc","createSignalMesh","__name","size","color","texLoad","THREE.TextureLoader","geometry","THREE.PlaneGeometry","material","THREE.MeshLambertMaterial","THREE.Color","THREE.DoubleSide","plane","THREE.Mesh","S","_s","animation","timer","onBeforeMount","scene","onMounted","ambientLight","hemisphereLight","dirLight","dirLight1","dirLight2","spotLight","camera","SignalMesh","props","SignalElement","renderer","render","onBeforeUpdate","gl","_a"],"mappings":"ySAAA,MAAeA,EAAA,GAAA,IAAA,IAAA,sBAAA,YAAA,GAAA,EAAA,KCGTC,EAAmBC,EAAA,CAACC,EAAe,EAAGC,EAAgB,YAAc,CAClE,MAAAC,EAAU,IAAIC,EACdC,EAAW,IAAIC,EAAoBL,EAAM,GAAMA,CAAI,EACzDI,EAAS,UAAU,CAACJ,EAAO,EAAG,EAAG,CAAC,EACzBI,EAAA,QAAQ,KAAK,GAAK,CAAC,EACtB,MAAAE,EAAW,IAAIC,EAA0B,CAE7C,IAAKL,EAAQ,KAAKL,CAAM,EACxB,MAAO,IAAIW,EAAYP,CAAK,EAC5B,YAAa,GACb,KAAMQ,EACN,SAAU,IAAID,EAAYP,CAAK,CAAA,CAChC,EAEKS,EAAQ,IAAIC,EAAWP,EAAUE,CAAQ,EAC/CI,EAAM,QAAQ,CAAC,KAAK,GAAK,CAAC,EAG1B,MAAME,EAAG,IACT,IAAIC,EAAK,EACT,SAASC,GAAY,CACbD,GAAA,GACNH,EAAM,MAAM,IAAIG,EAAIA,EAAKA,CAAE,EACvBA,GAAMD,EAAE,GACRN,EAAS,SAAWO,EAAK,IAAKD,EAAE,GAAI,GAC7BC,EAAKD,EAAE,IAAOC,GAAMD,EAC3BN,EAAS,QAAU,GAAKO,EAAKD,EAAE,KAAOA,EAAIA,EAAE,IAEvCC,EAAA,EAET,sBAAsBC,CAAS,CACjC,CAXS,OAAAf,EAAAe,EAAA,aAYCA,IAEHJ,CACT,EAnCyB,+KC+BzB,IAAIK,EAAa,KAEjB,OAAAC,EAAc,IAAM,CACdD,GAAO,qBAAqBA,CAAK,EACrCE,EAAM,OAAO,MAAMA,EAAOA,EAAM,QAAQ,CAAA,CACzC,EAEDC,EAAU,IAAM,CAEdD,EAAM,IAAIE,CAAY,EACtBF,EAAM,IAAIG,CAAe,EACzBH,EAAM,IAAII,CAAQ,EAClBJ,EAAM,IAAIK,CAAS,EACnBL,EAAM,IAAIM,CAAS,EACnBN,EAAM,IAAIO,CAAS,EAGnBC,EAAO,KAAO,EAGd,MAAMC,EAAa5B,EAAiB6B,EAAM,KAAMA,EAAM,KAAK,EAC3DD,EAAW,SAAS,EAAI,EACxBA,EAAW,SAAS,EAAI,IAExBT,EAAM,IAAKS,CAAW,EAKhB,MAAAE,EAAgB,SAAS,eAAe,QAAQ,EAClDA,GAA6BA,EAAA,YAAYC,EAAS,UAAU,EAChE,MAAMC,EAAS/B,EAAA,IAAM,CACV8B,EAAA,OAAOZ,EAAOQ,CAAM,EAC7BA,EAAO,uBAAuB,EAE9BV,EAAQ,sBAAsBe,CAAM,CAAA,EAJvB,UAORA,GAAA,CACR,EAEDC,EAAe,IAAM,OACnB,QAAQ,IAAI,gBAAgB,EAC5BF,EAAS,MAAM,EACfZ,EAAM,OAAO,MAAMA,EAAOA,EAAM,QAAQ,EACxCA,EAAM,OAAO,MAAMA,EAAOA,EAAM,QAAQ,EACxCY,EAAS,iBAAiB,EAC1B,qBAAqBd,CAAK,EAC1B,MAAMiB,EAAKH,EAAS,WAAW,WAAW,OAAO,EACjDG,KAAMC,EAAAD,EAAG,aAAa,oBAAoB,IAApC,MAAAC,EAAuC,cAAY,CAC1D;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}