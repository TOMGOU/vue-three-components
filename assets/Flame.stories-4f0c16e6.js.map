{"version":3,"file":"Flame.stories-4f0c16e6.js","sources":["../../packages/Flame/texture/flame.png","../../packages/Flame/index.ts","../../src/stories/components/flame/index.vue"],"sourcesContent":["export default \"__VITE_ASSET__064b53d6__\"","import * as THREE from 'three'\nimport imgSrc from './texture/flame.png'\n\ninterface Stoppable {\n  stop(): void;\n}\n\nclass CustomGroup extends THREE.Group implements Stoppable {\n  timer: number;\n\n  constructor(timer: number) {\n    super();\n    this.timer = timer;\n  }\n\n  stop() {\n    window.cancelAnimationFrame(this.timer);\n  }\n}\n\nconst createFlame = (w: number = 250) => {\n  const h = 1.6 * w\n  const geometry = new THREE.PlaneGeometry(w, h)\n  geometry.translate(0, h / 2, 0)\n\n  const textureLoader = new THREE.TextureLoader()\n  // const texture = textureLoader.load('./texture/flame.png')\n  const texture = textureLoader.load(imgSrc)\n  const num = 15\n  let t = 0\n  let timer: number = -1\n  texture.repeat.set(1 / num, 1)\n  const material = new THREE.MeshBasicMaterial({\n    map: texture,\n    transparent: true,\n    opacity: 0.4, //整体调节透明度 和三维场景相融合\n    side: THREE.DoubleSide, //双面可见\n    depthWrite: false, //是否对深度缓冲区有任何的影响\n  })\n  const mesh = new THREE.Mesh(geometry, material)\n  const flame = new CustomGroup(timer);\n  flame.add(mesh, mesh.clone().rotateY(Math.PI / 2), mesh.clone().rotateY(Math.PI / 4), mesh.clone().rotateY(Math.PI / 4 * 3))\n\n  // 火焰动画生成\n  const UpdateLoop = () => {\n    t += 0.1\n    if (t > num) t = 0\n    texture.offset.x = Math.floor(t) / num\n    timer = window.requestAnimationFrame(UpdateLoop)\n  }\n\n  UpdateLoop()\n\n  return flame\n}\n\nexport { createFlame }\n","<template>\n  <div id=\"Flame\"></div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted, onBeforeUpdate, watch, onBeforeMount } from 'vue';\nimport * as THREE from 'three'\nimport { scene, renderer, camera } from '../basic/three'\n// import { controls } from '../basic/controls'\nimport { createFlame } from '../../../../packages/index'\n\nconst props = defineProps({\n  size: {\n    type: Number,\n    default: 250,\n    required: false\n  },\n})\n\nlet timer: any = null\n\nonBeforeMount(() => {\n  if (timer) cancelAnimationFrame(timer)\n  scene.remove.apply(scene, scene.children)\n})\n\nonMounted(() => {\n  camera.zoom = 1;\n  const FlameMesh = createFlame(props.size)\n  FlameMesh.position.z = 0\n  FlameMesh.rotateX(-Math.PI / 4)\n  scene.add( FlameMesh );\n  const axesHelper = new THREE.AxesHelper(5000);\n  // scene.add(axesHelper);\n  const FlameElement = document.getElementById('Flame')\n  if (FlameElement) FlameElement.appendChild(renderer.domElement)\n  const render = () => {\n    renderer.render(scene, camera)\n    camera.updateProjectionMatrix()\n    // controls.update()\n    timer = requestAnimationFrame(render)\n  }\n\n  render()\n})\n\nonBeforeUpdate(() => {\n  console.log('onBeforeUpdate')\n  renderer.clear()\n  scene.remove.apply(scene, scene.children)\n  scene.remove.apply(scene, scene.children)\n  renderer.forceContextLoss()\n  cancelAnimationFrame(timer)\n  const gl = renderer.domElement.getContext('webgl')\n  gl && gl.getExtension('WEBGL_lose_context')?.loseContext()\n})\n</script>"],"names":["imgSrc","CustomGroup","THREE.Group","timer","__publicField","__name","createFlame","w","h","geometry","THREE.PlaneGeometry","texture","THREE.TextureLoader","num","t","material","THREE.MeshBasicMaterial","THREE.DoubleSide","mesh","THREE.Mesh","flame","UpdateLoop","onBeforeMount","scene","onMounted","camera","FlameMesh","props","THREE.AxesHelper","FlameElement","renderer","render","onBeforeUpdate","gl","_a"],"mappings":"uZAAA,MAAeA,EAAA,GAAA,IAAA,IAAA,qBAAA,YAAA,GAAA,EAAA,KCOf,MAAMC,UAAoBC,CAAiC,CAGzD,YAAYC,EAAe,CACnB,QAHRC,EAAA,cAIE,KAAK,MAAQD,CACf,CAEA,MAAO,CACE,OAAA,qBAAqB,KAAK,KAAK,CACxC,CACF,CAXME,EAAAJ,EAAA,eAaN,MAAMK,EAAcD,EAAA,CAACE,EAAY,MAAQ,CACvC,MAAMC,EAAI,IAAMD,EACVE,EAAW,IAAIC,EAAoBH,EAAGC,CAAC,EAC7CC,EAAS,UAAU,EAAGD,EAAI,EAAG,CAAC,EAIxB,MAAAG,EAFgB,IAAIC,IAEI,KAAKZ,CAAM,EACnCa,EAAM,GACZ,IAAIC,EAAI,EACJX,EAAgB,GACpBQ,EAAQ,OAAO,IAAI,EAAIE,EAAK,CAAC,EACvB,MAAAE,EAAW,IAAIC,EAAwB,CAC3C,IAAKL,EACL,YAAa,GACb,QAAS,GACT,KAAMM,EACN,WAAY,EAAA,CACb,EACKC,EAAO,IAAIC,EAAWV,EAAUM,CAAQ,EACxCK,EAAQ,IAAInB,EAAYE,CAAK,EAC7BiB,EAAA,IAAIF,EAAMA,EAAK,MAAM,EAAE,QAAQ,KAAK,GAAK,CAAC,EAAGA,EAAK,MAAM,EAAE,QAAQ,KAAK,GAAK,CAAC,EAAGA,EAAK,MAAA,EAAQ,QAAQ,KAAK,GAAK,EAAI,CAAC,CAAC,EAG3H,MAAMG,EAAahB,EAAA,IAAM,CAClBS,GAAA,GACDA,EAAID,IAASC,EAAA,GACjBH,EAAQ,OAAO,EAAI,KAAK,MAAMG,CAAC,EAAID,EAC3BV,EAAA,OAAO,sBAAsBkB,CAAU,CAAA,EAJ9B,cAOR,OAAAA,IAEJD,CACT,EAlCoB,wHCDpB,IAAIjB,EAAa,KAEjB,OAAAmB,EAAc,IAAM,CACdnB,GAAO,qBAAqBA,CAAK,EACrCoB,EAAM,OAAO,MAAMA,EAAOA,EAAM,QAAQ,CAAA,CACzC,EAEDC,EAAU,IAAM,CACdC,EAAO,KAAO,EACR,MAAAC,EAAYpB,EAAYqB,EAAM,IAAI,EACxCD,EAAU,SAAS,EAAI,EACvBA,EAAU,QAAQ,CAAC,KAAK,GAAK,CAAC,EAC9BH,EAAM,IAAKG,CAAU,EACF,IAAIE,EAAiB,GAAI,EAEtC,MAAAC,EAAe,SAAS,eAAe,OAAO,EAChDA,GAA2BA,EAAA,YAAYC,EAAS,UAAU,EAC9D,MAAMC,EAAS1B,EAAA,IAAM,CACVyB,EAAA,OAAOP,EAAOE,CAAM,EAC7BA,EAAO,uBAAuB,EAE9BtB,EAAQ,sBAAsB4B,CAAM,CAAA,EAJvB,UAORA,GAAA,CACR,EAEDC,EAAe,IAAM,OACnB,QAAQ,IAAI,gBAAgB,EAC5BF,EAAS,MAAM,EACfP,EAAM,OAAO,MAAMA,EAAOA,EAAM,QAAQ,EACxCA,EAAM,OAAO,MAAMA,EAAOA,EAAM,QAAQ,EACxCO,EAAS,iBAAiB,EAC1B,qBAAqB3B,CAAK,EAC1B,MAAM8B,EAAKH,EAAS,WAAW,WAAW,OAAO,EACjDG,KAAMC,EAAAD,EAAG,aAAa,oBAAoB,IAApC,MAAAC,EAAuC,cAAY,CAC1D;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}