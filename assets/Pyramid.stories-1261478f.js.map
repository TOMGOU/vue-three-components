{"version":3,"file":"Pyramid.stories-1261478f.js","sources":["../../packages/Pyramid/index.ts","../../src/stories/components/pyramid/index.vue"],"sourcesContent":["import * as THREE from 'three'\nimport { createWaveMesh } from '../Wave/index'\n\nconst createPyramidMesh = (size: number = 60, color: string = '#22ffcc') => {\n  const height = size * 4\n  const geometry = new THREE.ConeGeometry(size, height, 4)\n  geometry.rotateX(-Math.PI / 2)\n  geometry.translate(0, 0, height / 2)\n  const material = new THREE.MeshLambertMaterial({\n    color: new THREE.Color(color),\n  });\n  const mesh = new THREE.Mesh(geometry, material)\n\n  const mesh2 = mesh.clone()\n  mesh2.scale.z = 0.5\n  mesh2.position.z = height * (1 + mesh2.scale.z)\n  mesh2.rotateX(Math.PI)\n  mesh.add(mesh2)\n\n  const animation = () => {\n    mesh.rotateZ(0.05)\n    material.needsUpdate = true\n    requestAnimationFrame(animation)\n  }\n  animation()\n\n  const WaveMesh =  createWaveMesh(size, color)\n  WaveMesh.position.z = height\n  mesh.add(WaveMesh)\n\n  return mesh\n}\n\nexport { createPyramidMesh }\n","<template>\n  <div id=\"Pyramid\"></div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted, onBeforeUpdate, watch, onBeforeMount } from 'vue';\nimport * as THREE from 'three'\nimport {\n  scene,\n  renderer,\n  camera,\n  ambientLight,\n  hemisphereLight,\n  dirLight,\n  dirLight1,\n  dirLight2,\n  spotLight\n} from '../basic/three'\n// import { controls } from '../basic/controls'\nimport { createPyramidMesh } from '../../../../packages/index'\n\nconst props = defineProps({\n  size: {\n    type: Number,\n    default: 20,\n    required: false\n  },\n  color: {\n    type: String,\n    default: '#22ffcc',\n    required: false\n  }\n})\n\nlet timer: any = null\n\nonBeforeMount(() => {\n  if (timer) cancelAnimationFrame(timer)\n  scene.remove.apply(scene, scene.children)\n})\n\nonMounted(() => {\n  // 添加光源\n  scene.add(ambientLight)\n  scene.add(hemisphereLight)\n  scene.add(dirLight)\n  scene.add(dirLight1)\n  scene.add(dirLight2)\n  scene.add(spotLight)\n\n  // 重置相机缩放比例\n  camera.zoom = 1;\n\n  // 添加棱锥网格\n  const PyramidMesh = createPyramidMesh(props.size, props.color)\n  PyramidMesh.position.z = 0\n  PyramidMesh.rotateX(-Math.PI / 4)\n  scene.add( PyramidMesh );\n\n  // const axesHelper = new THREE.AxesHelper(5000);\n  // scene.add(axesHelper);\n\n  const PyramidElement = document.getElementById('Pyramid')\n  if (PyramidElement) PyramidElement.appendChild(renderer.domElement)\n  const render = () => {\n    renderer.render(scene, camera)\n    camera.updateProjectionMatrix()\n    // controls.update()\n    timer = requestAnimationFrame(render)\n  }\n\n  render()\n})\n\nonBeforeUpdate(() => {\n  console.log('onBeforeUpdate')\n  renderer.clear()\n  scene.remove.apply(scene, scene.children)\n  scene.remove.apply(scene, scene.children)\n  renderer.forceContextLoss()\n  cancelAnimationFrame(timer)\n  const gl = renderer.domElement.getContext('webgl')\n  gl && gl.getExtension('WEBGL_lose_context')?.loseContext()\n})\n</script>"],"names":["createPyramidMesh","__name","size","color","height","geometry","THREE.ConeGeometry","material","THREE.MeshLambertMaterial","THREE.Color","mesh","THREE.Mesh","mesh2","animation","WaveMesh","createWaveMesh","timer","onBeforeMount","scene","onMounted","ambientLight","hemisphereLight","dirLight","dirLight1","dirLight2","spotLight","camera","PyramidMesh","props","PyramidElement","renderer","render","onBeforeUpdate","gl","_a"],"mappings":"mUAGA,MAAMA,EAAoBC,EAAA,CAACC,EAAe,GAAIC,EAAgB,YAAc,CAC1E,MAAMC,EAASF,EAAO,EAChBG,EAAW,IAAIC,EAAmBJ,EAAME,EAAQ,CAAC,EACvDC,EAAS,QAAQ,CAAC,KAAK,GAAK,CAAC,EAC7BA,EAAS,UAAU,EAAG,EAAGD,EAAS,CAAC,EAC7B,MAAAG,EAAW,IAAIC,EAA0B,CAC7C,MAAO,IAAIC,EAAYN,CAAK,CAAA,CAC7B,EACKO,EAAO,IAAIC,EAAWN,EAAUE,CAAQ,EAExCK,EAAQF,EAAK,QACnBE,EAAM,MAAM,EAAI,GAChBA,EAAM,SAAS,EAAIR,GAAU,EAAIQ,EAAM,MAAM,GACvCA,EAAA,QAAQ,KAAK,EAAE,EACrBF,EAAK,IAAIE,CAAK,EAEd,MAAMC,EAAYZ,EAAA,IAAM,CACtBS,EAAK,QAAQ,GAAI,EACjBH,EAAS,YAAc,GACvB,sBAAsBM,CAAS,CAAA,EAHf,aAKRA,IAEJ,MAAAC,EAAYC,EAAeb,EAAMC,CAAK,EAC5C,OAAAW,EAAS,SAAS,EAAIV,EACtBM,EAAK,IAAII,CAAQ,EAEVJ,CACT,EA5B0B,iLC+B1B,IAAIM,EAAa,KAEjB,OAAAC,EAAc,IAAM,CACdD,GAAO,qBAAqBA,CAAK,EACrCE,EAAM,OAAO,MAAMA,EAAOA,EAAM,QAAQ,CAAA,CACzC,EAEDC,EAAU,IAAM,CAEdD,EAAM,IAAIE,CAAY,EACtBF,EAAM,IAAIG,CAAe,EACzBH,EAAM,IAAII,CAAQ,EAClBJ,EAAM,IAAIK,CAAS,EACnBL,EAAM,IAAIM,CAAS,EACnBN,EAAM,IAAIO,CAAS,EAGnBC,EAAO,KAAO,EAGd,MAAMC,EAAc3B,EAAkB4B,EAAM,KAAMA,EAAM,KAAK,EAC7DD,EAAY,SAAS,EAAI,EACzBA,EAAY,QAAQ,CAAC,KAAK,GAAK,CAAC,EAChCT,EAAM,IAAKS,CAAY,EAKjB,MAAAE,EAAiB,SAAS,eAAe,SAAS,EACpDA,GAA+BA,EAAA,YAAYC,EAAS,UAAU,EAClE,MAAMC,EAAS9B,EAAA,IAAM,CACV6B,EAAA,OAAOZ,EAAOQ,CAAM,EAC7BA,EAAO,uBAAuB,EAE9BV,EAAQ,sBAAsBe,CAAM,CAAA,EAJvB,UAORA,GAAA,CACR,EAEDC,EAAe,IAAM,OACnB,QAAQ,IAAI,gBAAgB,EAC5BF,EAAS,MAAM,EACfZ,EAAM,OAAO,MAAMA,EAAOA,EAAM,QAAQ,EACxCA,EAAM,OAAO,MAAMA,EAAOA,EAAM,QAAQ,EACxCY,EAAS,iBAAiB,EAC1B,qBAAqBd,CAAK,EAC1B,MAAMiB,EAAKH,EAAS,WAAW,WAAW,OAAO,EACjDG,KAAMC,EAAAD,EAAG,aAAa,oBAAoB,IAApC,MAAAC,EAAuC,cAAY,CAC1D;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}